name: Comment Reply Automation

permissions:
  contents: read
  pull-requests: write
  issues: write

on:
  issue_comment:
    types: [created, edited]
  pull_request_review_comment:
    types: [created, edited]

jobs:
  reply-to-badge-comments:
    runs-on: ubuntu-latest
    # secrets.PAT_TOKENがない (フォークPRなど) 場合はステップでスキップ

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Badge付きコメントに返信 (config-driven)
        if: ${{ env.PAT_TOKEN != '' }}
        uses: actions/github-script@v7
        env:
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
        with:
          # Personal Access Tokenを使用してCodexをトリガー
          # GITHUB_TOKENではCodexが反応しないため、PATが必要
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            const script = require('./.github/scripts/reply-to-badge-comment.js');
            await script({ github, context });
