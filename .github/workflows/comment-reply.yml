name: Comment Reply Automation

permissions:
  contents: read
  pull-requests: write
  issues: write

on:
  issue_comment:
    types: [created, edited]
  pull_request_review_comment:
    types: [created, edited]

jobs:
  reply-to-badge-comments:
    runs-on: ubuntu-latest
    # PAT_TOKENがない場合（フォークPRなど）はスクリプト内で早期終了

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Badge付きコメントに返信 (config-driven)
        uses: actions/github-script@v7
        env:
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
        with:
          # Personal Access Tokenを使用してCodexをトリガー
          # GITHUB_TOKENではCodexが反応しないため、PATが必要
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            // PAT_TOKENがない場合（フォークPRなど）は早期終了
            if (!process.env.PAT_TOKEN) {
              console.log('PAT_TOKEN is not available. Skipping...');
              return;
            }
            const script = require('./.github/scripts/reply-to-badge-comment.js');
            await script({ github, context });
